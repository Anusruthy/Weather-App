<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Simple Weather | Anusruthy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
.forecast-container {
    display: flex !important;
    gap: 1rem;
}
</style>
</head>
<body>
  <div class="container">
    <h1>üå§ Simple Weather ‚Äî by Anusruthy</h1>
    
    <details>
      <summary>Info</summary>
      <p>
        üå¶Ô∏è <b>Weather App</b> is a portfolio project built by <b>Anusruthy</b>.  
        It demonstrates how to integrate real-time APIs, implement CRUD operations 
        with a database, and allow exporting data in multiple formats.  
      </p>
      
      <p>
        The app is powered by <b>Flask</b> (Python) on the backend, uses 
        <b>SQLite</b> for data persistence, and integrates with external APIs like OpenWeather and Google Maps.  
      </p>
  
      <p>
        The project is containerized with <b>Docker</b>, making it easy to 
        build, run, and deploy anywhere.  
      </p>
    </details>

    <!-- Search Form -->
    <form method="get" action="/" class="card">
      <label for="location">Enter a location (city/town/zip):</label>
      <input id="location" name="location" type="text" placeholder="e.g., Kochi, IN or 682001" value="{{ query|e }}">
      <button type="submit">Get Weather</button>
    </form>

    <!-- Error Message -->
    {% if error %}
      <div class="card error">{{ error }}</div>
    {% endif %}

        <!-- Current Weather -->
    {% if weather %}
      <div class="card weather-card">
        <div class="title">{{ place }}</div>
        <img alt="Weather icon" src="https://openweathermap.org/img/wn/{{ weather.icon }}@2x.png">
        <p><strong>{{ weather.temp }}¬∞C</strong> ‚Äî {{ weather.description }}</p>
        <p>Feels like: {{ weather.feels_like }}¬∞C</p>
        <p>Humidity: {{ weather.humidity }}%</p>
        <p>Wind speed: {{ weather.wind_speed }} m/s</p>
      </div>

      <!-- Save Weather Form -->
      <form method="post" action="/save" class="card save-form">
        <input type="hidden" name="location_name" value="{{ place }}">
        <input type="hidden" name="lat" value="{{ geo_lat }}">
        <input type="hidden" name="lon" value="{{ geo_lon }}">

        <label>Start Date:</label>
        <input type="date" name="start_date" required>

        <label>End Date:</label>
        <input type="date" name="end_date" required>

        <button type="submit" class="btn-primary">Save This Weather</button>
      </form>

      <!-- Map Integration -->
      <div id="map" style="height: 400px; margin-top: 1rem; border-radius: 12px;"></div>
      <script>
        var map = L.map('map').setView([{{ geo_lat }}, {{ geo_lon }}], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        L.marker([{{ geo_lat }}, {{ geo_lon }}]).addTo(map)
            .bindPopup("<b>{{ place }}</b><br>{{ weather.temp }}¬∞C, {{ weather.description }}")
            .openPopup();
      </script>
    {% endif %}
    
    <!-- 5-Day Forecast -->
    {% if forecast %}
      <div class="card">
        <h3>5-Day Forecast</h3>
        <div class="forecast-container">
          {% for day in forecast %}
            <div class="forecast-card">
              <strong>{{ day.date }}</strong><br>
              <img src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png" alt="icon"><br>
              {{ day.temp }}¬∞C<br>
              <small>{{ day.description }}</small>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <!-- Saved Queries -->
    {% if saved_queries %}
      <div class="card">
        <h3>Saved Searches</h3>
        <ul class="saved-list">
          {% for q in saved_queries %}
            <li>
              {{ q.location_name }} ({{ q.start_date }} to {{ q.end_date }})
              <a class="delete-link" href="{{ url_for('delete_weather', query_id=q.id) }}">Delete</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
</body>
</html>
